# Pricing & Cost Tracking

`clauderock` tracks your usage and provides cost estimates based on actual token consumption.

## How It Works

### Session Tracking

Every time you run `clauderock`, it:
1. Launches Claude Code
2. Waits for the session to end
3. Parses Claude Code's session JSONL file
4. Extracts token usage (input, output, cache read/creation)
5. Calculates TPM/RPM metrics
6. Stores everything in `~/.clauderock/usage.db`

### Cost Calculation

Costs are calculated using:
- **Actual token counts** from Claude Code's API calls
- **AWS Bedrock pricing** for the specific model used
- **No estimation** - real usage data

**Formula:**
```
Cost = (InputTokens × InputPrice) + (OutputTokens × OutputPrice)
```

Prices are per 1 million tokens.

## Privacy

**All data stays local:**
- Stored in `~/.clauderock/usage.db`
- Never transmitted anywhere
- You can delete the database anytime

## Viewing Stats

```bash
# View all-time stats
clauderock manage stats

# Today's usage
clauderock manage stats --today

# This month
clauderock manage stats --month 2025-10

# Filter by profile
clauderock manage stats --profile work-dev

# Filter by model
clauderock manage stats --model anthropic.claude-opus-4

# Export to CSV
clauderock manage stats --export report.csv
```

## Metrics Tracked

### Token Usage
- **Input Tokens**: New tokens sent to the model
- **Output Tokens**: Tokens generated by the model
- **Cache Read Tokens**: Tokens read from prompt cache (don't count toward rate limits!)
- **Cache Creation Tokens**: Tokens written to cache (count toward rate limits)

### TPM/RPM Metrics
- **TPM (Tokens Per Minute)**: Calculated using AWS formula
  - `TPM = InputTokens + OutputTokens + CacheCreationTokens`
  - Cache Read tokens are **excluded** (they're free!)
- **RPM (Requests Per Minute)**: API requests per minute
- **Average, Peak, P95**: Statistical metrics across the session

### Cache Efficiency
- **Cache Hit Rate**: Percentage of tokens served from cache
  - `CacheReadTokens / (InputTokens + CacheReadTokens) × 100`
  - Higher is better (means you're reusing context)

## AWS Bedrock Pricing

Current pricing (as of October 2025):

### Anthropic Models

| Model | Input (per 1M tokens) | Output (per 1M tokens) |
|-------|----------------------|------------------------|
| Claude Opus 4 | $15.00 | $75.00 |
| Claude Sonnet 4.5 | $3.00 | $15.00 |
| Claude Haiku 4.5 | $0.80 | $4.00 |

### Prompt Caching (Anthropic Models)

| Type | Price (per 1M tokens) |
|------|----------------------|
| Cache Writes | 25% of base input price |
| Cache Reads | 90% discount (10% of input price) |

**Example:**
- Claude Sonnet 4.5 base input: $3.00/1M tokens
- Cache write: $0.75/1M tokens
- Cache read: $0.30/1M tokens

### Meta Models

| Model | Input (per 1M tokens) | Output (per 1M tokens) |
|-------|----------------------|------------------------|
| Llama 3.2 90B | $0.80 | $0.80 |
| Llama 3.2 11B | $0.16 | $0.16 |

### Amazon Models

| Model | Input (per 1M tokens) | Output (per 1M tokens) |
|-------|----------------------|------------------------|
| Titan Text Premier | $0.50 | $1.50 |

**Note:** Prices may change. Check [AWS Bedrock Pricing](https://aws.amazon.com/bedrock/pricing/) for the latest.

## Understanding Your Costs

### Example Session

```
Session Statistics (2025-10-25):

Token Usage:
  Total Requests: 42
  Input Tokens: 150,000
  Output Tokens: 45,000
  Cache Read Tokens: 1,200,000
  Cache Creation Tokens: 50,000

Cache Efficiency:
  Average Hit Rate: 88.9%
```

**Cost Calculation (Claude Sonnet 4.5):**
- Input: 150,000 tokens × $3.00 / 1M = $0.45
- Output: 45,000 tokens × $15.00 / 1M = $0.68
- Cache Creation: 50,000 tokens × $0.75 / 1M = $0.04
- **Total: $1.17**

**Savings from caching:**
- Without cache: 1,200,000 more input tokens = +$3.60
- With cache reads: 1,200,000 × $0.30 / 1M = $0.36
- **You saved: $3.24** (90%)

## Cost Optimization Tips

### 1. Use Prompt Caching
- Keep context consistent across requests
- High cache hit rates save money
- Look for >70% cache hit rate

### 2. Choose the Right Model
- **Haiku**: Fast, cheap for simple tasks
- **Sonnet**: Balanced for most coding
- **Opus**: Expensive, use for complex reasoning

### 3. Monitor Your Usage
```bash
# Check daily costs
clauderock manage stats --today

# Compare profile costs
clauderock manage stats --profile work-dev
clauderock manage stats --profile personal
```

### 4. Export and Analyze
```bash
clauderock manage stats --export monthly-report.csv
# Open in Excel/Google Sheets to find patterns
```

## Resetting Stats

If you want to start fresh or had incorrect data:

```bash
# Reset with confirmation
clauderock manage stats reset

# Force reset (skip confirmation)
clauderock manage stats reset --force
```

**Warning:** This permanently deletes all usage history!

## Disclaimers

- **Estimates**: Costs are calculated from tracked sessions. Actual AWS bills may vary due to:
  - Rounding differences
  - AWS billing granularity
  - Sessions tracked vs. not tracked
  - Pricing changes

- **Best Effort**: `clauderock` tracks what it can from Claude Code's JSONL files
  - Very short sessions may not generate files
  - Session tracking requires Claude Code to complete normally

- **Local Only**: All tracking is local to your machine
  - No data is sent to any server
  - You control your usage database

## Questions?

- Check your stats: `clauderock manage stats`
- View all sessions: `clauderock manage stats --export all-time.csv`
- Open an issue: https://github.com/OlaHulleberg/clauderock/issues
